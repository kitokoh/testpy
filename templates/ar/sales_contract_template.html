<!DOCTYPE html>
<html lang="{{doc_lang_code | default: 'fr'}}" dir="{{doc_direction | default: 'ltr'}}">
<head>
    <meta charset="UTF-8">
    <title>{{document_title}} - {{contract_number}}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: #000;
            font-size: 12pt;
            text-align: left; /* Default LTR text alignment */
        }
        html[dir="rtl"] body {
            text-align: right;
        }
        /* Helper class overrides for RTL */
        html[dir="rtl"] .text-left { text-align: right !important; }
        html[dir="rtl"] .text-right { text-align: left !important; }
        /* Table cells will inherit text-align from body, adjust if specific cells need to remain LTR/RTR */
        html[dir="rtl"] th, html[dir="rtl"] td {
            /* text-align: right; */ /* Generally inherited */
        }
        html[dir="rtl"] .products-table th, html[dir="rtl"] .products-table td {
            text-align: right; /* Specific for product table cells */
        }


        .contract-container {
            max-width: 17cm;
            margin: auto;
            padding: 0;
        }
        h1, h2, h3, .document-main-title, .article-title, .party-details strong {
            font-family: Arial, Helvetica, sans-serif;
            color: #000;
            margin-top: 0;
        }
        .document-main-title {
            text-align: center;
            font-size: 18pt;
            font-weight: bold;
            margin-bottom: 25px;
            text-transform: uppercase;
        }
        html[dir="rtl"] .document-main-title { /* Center is fine for RTL */
            text-align: center;
        }
        .contract-header {
            text-align: center;
            margin-bottom: 25px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 11pt;
        }
        html[dir="rtl"] .contract-header { /* Center is fine for RTL */
            text-align: center;
        }
        .party-details {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #eee;
            font-size: 11pt;
        }
        .party-details strong {
            font-size: 13pt;
            font-weight: bold;
        }
        .article {
            margin-bottom: 20px;
        }
        .article-title {
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 3px;
            border-bottom: 1px solid #666;
        }
        .article-content p, .article-content ul, .article-content div {
            margin-bottom: 10px;
            font-size: 12pt;
        }
        .article-content ul {
            list-style-type: disc;
            margin-left: 40px; /* LTR default */
        }
        html[dir="rtl"] .article-content ul {
            margin-left: 0;
            margin-right: 40px; /* RTL margin */
        }
        .signature-section {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 10pt;
        }
        .signature-block {
            width: 45%;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        .signature-block p {
            margin: 8px 0;
        }
        .annex-list {
            margin-top: 30px;
            font-style: italic;
            font-size: 11pt;
        }
        /* .text-center, .bold, .underline are utility classes, RTL handled by specific overrides or inheritance */

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 10px;
            font-size: 10pt;
        }
        .products-table th, .products-table td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left; /* Default for LTR tables */
        }
        .products-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            font-family: Arial, Helvetica, sans-serif;
        }
        .preamble {
            margin-bottom: 20px;
            font-style: italic;
            font-size: 11pt;
        }
    </style>
</head>
<body>
    <div class="contract-container">
        <div class="document-main-title">{{document_title}}</div>

        <div class="contract-header">
            <p><span class="bold">Numéro de Contrat :</span> {{contract_number}}</p>
            <p><span class="bold">Date d'Entrée en Vigueur :</span> {{date_of_agreement}}</p>
        </div>

        <div class="party-details">
            <p><strong class="party-title">ENTRE :</strong></p>
            <p><strong class="party-role">Le Vendeur :</strong></p>
            <p><span class="bold">{{seller_company_name}}</span></p>
            <p>Adresse : {{seller_company_address}}</p>
            <p>Immatriculée sous le numéro : {{seller_company_registration_number}}</p>
            <p>Représentée par : {{seller_representative_name}}, {{seller_representative_title}}</p>
            <p>Ci-après dénommé le « Vendeur ».</p>
        </div>

        <div class="party-details">
            <p><strong class="party-title">ET :</strong></p>
            <p><strong class="party-role">L'Acheteur :</strong></p>
            <p><span class="bold">{{buyer_company_name}}</span></p>
            <p>Adresse : {{buyer_company_address}}</p>
            <p>Immatriculée sous le numéro : {{buyer_company_registration_number}}</p>
            <p>Représenté par : {{buyer_representative_name}}, {{buyer_representative_title}}</p>
            <p>Ci-après dénommé l' « Acheteur ».</p>
        </div>

        <div class="preamble">
            <h3 class="article-title">Préambule</h3>
            <p>{{preamble_text}}</p>
            <p>Les parties conviennent de ce qui suit :</p>
        </div>

        <div class="article">
            <h3 class="article-title">Article 1 : Objet du Contrat</h3>
            <div class="article-content">
                <p>1.1. <span class="underline">Description des Biens/Services :</span> {{subject_matter_general_description}}</p>
                {{#if products}}
                <p>Les biens (ci-après dénommés les "Produits") faisant l'objet du présent contrat sont les suivants :</p>
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Description du Produit</th>
                            <th>Quantité</th>
                            <th>Spécifications/Qualité</th>
                            <th>Prix Unitaire</th>
                            <th>Prix Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each products}}
                        <tr>
                            <td>{{product_name}}</td>
                            <td>{{product_quantity}} {{product_unit}}</td>
                            <td>{{product_specifications}}</td>
                            <td class="text-right">{{product_unit_price_formatted}} {{currency_symbol}}</td> <!-- Price always right -->
                            <td class="text-right">{{product_total_price_formatted}} {{currency_symbol}}</td> <!-- Price always right -->
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{/if}}
                <p>1.2. <span class="underline">Quantité Totale :</span> {{total_quantity}}</p>
                <p>1.3. <span class="underline">Qualité et Spécifications :</span> {{quality_specifications_details}}</p>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 2 : Prix et Modalités de Paiement</h3>
            <div class="article-content">
                <p>2.1. <span class="underline">Prix Total :</span> {{total_price_formatted}} {{currency_symbol}} ({{total_price_in_words}}).</p>
                {{^products}}
                <p>2.2. <span class="underline">Prix par Unité (si applicable) :</span> {{price_per_unit_formatted}} {{currency_symbol}}.</p>
                {{/products}}
                <p>2.3. <span class="underline">Modalités de Paiement :</span> {{payment_method_description}}.</p>
                <p>2.4. <span class="underline">Échéancier de Paiement :</span> {{payment_schedule_description}}.</p>
                <p>2.5. <span class="underline">Coordonnées Bancaires du Vendeur :</span></p>
                <ul>
                    <li>Banque : {{seller_bank_name}}</li>
                    <li>Adresse de la Banque : {{seller_bank_address}}</li>
                    <li>Numéro de Compte / IBAN : {{seller_bank_iban}}</li>
                    <li>Code SWIFT/BIC : {{seller_bank_swift}}</li>
                    <li>Titulaire du Compte : {{seller_bank_account_holder_name}}</li>
                </ul>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 3 : Conditions de Livraison</h3>
            <div class="article-content">
                <p>3.1. <span class="underline">Incoterms® :</span> {{delivery_incoterms}}.</p>
                <p>3.2. <span class="underline">Lieu de Livraison :</span> {{delivery_place}}.</p>
                <p>3.3. <span class="underline">Date de Livraison Estimée :</span> {{estimated_delivery_date}}.</p>
                <p>3.4. <span class="underline">Expéditions Partielles :</span> {{partial_shipments_allowed_description}}.</p>
                <p>3.5. <span class="underline">Documents d'Expédition Requis :</span> {{shipping_documents_required}}.</p>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 4 : Inspection des Marchandises</h3>
            <div class="article-content">
                <p>{{inspection_of_goods_clause}}</p>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 5 : Garantie</h3>
            <div class="article-content">
                <p>5.1. <span class="underline">Période de Garantie :</span> {{warranty_period}}.</p>
                <p>5.2. <span class="underline">Conditions de Garantie :</span> {{warranty_conditions}}.</p>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 6 : Force Majeure</h3>
            <div class="article-content">
                <p>{{force_majeure_clause}}</p>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 7 : Droit Applicable et Résolution des Litiges</h3>
            <div class="article-content">
                <p>7.1. <span class="underline">Droit Applicable :</span> Le présent contrat est régi et interprété conformément aux lois de {{applicable_law_jurisdiction}}.</p>
                <p>7.2. <span class="underline">Résolution des Litiges :</span> {{dispute_resolution_method}}.</p>
            </div>
        </div>

        <div class="article">
            <h3 class="article-title">Article 8 : Intégralité de l'Accord et Amendements</h3>
            <div class="article-content">
                <p>8.1. <span class="underline">Intégralité de l'Accord :</span> Le présent contrat constitue l'intégralité de l'accord entre les Parties concernant son objet et remplace tous les accords, négociations et discussions antérieurs, qu'ils soient oraux ou écrits, entre les Parties.</p>
                <p>8.2. <span class="underline">Amendements :</span> Toute modification ou amendement au présent contrat ne sera valable que si elle est faite par écrit et signée par les représentants dûment autorisés des deux Parties.</p>
            </div>
        </div>

        <div class="signature-section">
            <div class="signature-block">
                <p class="bold text-center">POUR LE VENDEUR :</p>
                <div style="height: 50px;"></div>
                <p style="border-top: 1px solid #000; padding-top: 5px;">Signature :</p>
                <p>Nom : {{seller_signature_name}}</p>
                <p>Titre : {{seller_signature_title}}</p>
                <p>Date : {{seller_signature_date}}</p>
            </div>
            <div class="signature-block">
                <p class="bold text-center">POUR L'ACHETEUR :</p>
                <div style="height: 50px;"></div>
                <p style="border-top: 1px solid #000; padding-top: 5px;">Signature :</p>
                <p>Nom : {{buyer_signature_name}}</p>
                <p>Titre : {{buyer_signature_title}}</p>
                <p>Date : {{buyer_signature_date}}</p>
            </div>
        </div>

        {{#if annexes_list}}
        <div class="annex-list">
            <h3 class="article-title">Annexes</h3>
            <p>Les documents suivants sont joints et font partie intégrante du présent contrat :</p>
            <ul>
                {{#each annexes_list}}
                <li>{{annex_title}}</li>
                {{/each}}
            </ul>
            {{#if annexes_placeholder_text}}<p>{{annexes_placeholder_text}}</p>{{/if}}
        </div>
        {{/if}}

    </div>
</body>
</html>
