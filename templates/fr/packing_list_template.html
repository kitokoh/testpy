<!DOCTYPE html>
<html lang="{{doc_lang_code | default: 'fr'}}" dir="{{doc_direction | default: 'ltr'}}">
<head>
    <meta charset="UTF-8">
    <title>Liste de Colisage - {{packing_list_number}}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: #333;
            font-size: 10pt;
            line-height: 1.4;
            text-align: left; /* Default LTR text alignment */
        }
        html[dir="rtl"] body {
            text-align: right;
        }
        /* Helper class overrides for RTL */
        html[dir="rtl"] .text-left { text-align: right !important; }
        html[dir="rtl"] .text-right { text-align: left !important; }
        /* Table cells will inherit text-align from body, adjust if specific cells need to remain LTR/RTR */
        html[dir="rtl"] th, html[dir="rtl"] td {
            /* text-align: right; */ /* Generally inherited, but can be specific if needed */
        }


        .packing-list-box {
            max-width: 17cm;
            margin: auto;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #666;
            padding: 5px;
            text-align: left; /* Default for LTR tables */
            vertical-align: top;
            font-size: 9pt;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        th {
            background-color: #f0f0f0;
            font-weight: bold;
            font-size: 9pt;
        }
        .header-table td, .parties-table td, .details-table td {
            border: none;
            padding: 3px 0;
        }
        .header-table { margin-bottom: 20px; }
        .document-title {
            font-size: 18pt;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #000;
        }
        html[dir="rtl"] .document-title { /* Center is fine for RTL too */
            text-align: center;
        }
        .company-logo {
            max-height: 70px;
            margin-bottom: 10px;
        }
        .section-title {
            font-size: 11pt;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 3px;
        }
        /* .text-right, .text-center, .bold are utility classes, RTL handled by specific overrides or inheritance */

        .totals-table td {
            font-weight: bold;
            font-size: 9pt;
        }
        .declaration, .instructions-section, .signature-section-container {
            margin-top: 20px;
            font-size: 9pt;
        }
        .signature-line {
            border-bottom: 1px solid #333;
            width: 250px;
            margin-top: 30px;
            margin-bottom: 5px;
        }
        .stamp-area {
            border: 1px dashed #ccc;
            height: 100px;
            width: 200px;
            text-align: center;
            padding: 5px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }
        html[dir="rtl"] .stamp-area { /* Center is fine for RTL */
            text-align: center;
        }
        .stamp-area img { max-width: 100%; max-height: 100%; }

        @media print {
            body { font-size: 10pt; }
            .packing-list-box { margin: 0; box-shadow: none; border: none; }
            th, td { border: 1px solid #333 !important; }
            .items-table th { font-size: 8pt; }
            .items-table td { font-size: 8pt; }
            .section-title { page-break-after: avoid; }
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
        }
    </style>
</head>
<body>
    <div class="packing-list-box">
        <table class="header-table">
            <tr>
                <td class="text-left"> <!-- Adjusted for explicit LTR/RTL handling -->
                    {{#if company_logo_path_for_stamp}}
                        <img src="{{company_logo_path_for_stamp}}" alt="Company Logo" class="company-logo">
                    {{/if}}
                </td>
                <td class="text-right"> <!-- Adjusted for explicit LTR/RTL handling -->
                    <h1 class="document-title">LISTE DE COLISAGE</h1>
                </td>
            </tr>
        </table>

        <table class="parties-table">
            <tr>
                <td style="width:50%;" class="text-left"> <!-- Adjusted -->
                    <div class="section-title">Exportateur / Expéditeur</div>
                    <strong>{{exporter_company_name}}</strong><br>
                    {{exporter_address}}<br>
                    Attn: {{exporter_contact_person}}<br>
                    Tel: {{exporter_phone}}<br>
                    Email: {{exporter_email}}
                </td>
                <td style="width:50%;" class="text-left"> <!-- Adjusted, content inside might be .text-right if needed by language -->
                    <div class="section-title">Destinataire (Consignee)</div>
                    <strong>{{consignee_name}}</strong><br>
                    {{consignee_address}}<br>
                    Attn: {{consignee_contact_person}}<br>
                    Tel: {{consignee_phone}}<br>
                    Email: {{consignee_email}}
                </td>
            </tr>
            {{#if notify_party_name}}
            <tr>
                <td colspan="2" class="text-left"> <!-- Adjusted -->
                    <div class="section-title">Partie à Notifier (Notify Party)</div>
                    <strong>{{notify_party_name}}</strong><br>
                    {{notify_party_address}}
                </td>
            </tr>
            {{/if}}
        </table>

        <table class="details-table">
            <tr>
                <td class="text-left"><strong>N° Liste de Colisage:</strong> {{packing_list_number}}</td>
                <td class="text-left"><strong>Date Liste de Colisage:</strong> {{packing_list_date}}</td>
            </tr>
            <tr>
                <td class="text-left"><strong>N° Facture:</strong> {{invoice_number}}</td>
                <td class="text-left"><strong>N° Commande:</strong> {{order_number}}</td>
            </tr>
            <tr>
                <td colspan="2" class="text-left"><strong>Date d'Expédition:</strong> {{date_of_shipment}}</td>
            </tr>
        </table>

        <div class="section-title text-left">Détails d'Expédition</div> <!-- Adjusted -->
        <table>
            <tr>
                <td style="width:50%;" class="text-left"><strong>Port de Chargement:</strong> {{port_of_loading}}</td>
                <td style="width:50%;" class="text-left"><strong>Port de Déchargement:</strong> {{port_of_discharge}}</td>
            </tr>
            <tr>
                <td colspan="2" class="text-left"><strong>Navire / Vol / Détails Transport:</strong> {{vessel_flight_details}}</td>
            </tr>
            <tr>
                <td colspan="2" class="text-left"><strong>Marques d'Expédition:</strong><br><div style="min-height: 40px; border: 1px solid #eee; padding: 5px;">{{shipping_marks}}</div></td>
            </tr>
        </table>

        <div class="section-title text-left">Contenu des Colis</div> <!-- Adjusted -->
        <table class="items-table">
            <thead>
                <tr>
                    <th>Code Article</th>
                    <th>Description</th>
                    <th class="text-center">Qté Colis</th> <!-- Explicit center -->
                    <th class="text-center">Unités/Colis</th> <!-- Explicit center -->
                    <th class="text-center">Total Unités</th> <!-- Explicit center -->
                    <th class="text-right">Poids Net/Unité (kg)</th> <!-- Explicit right -->
                    <th class="text-right">Poids Brut/Unité (kg)</th> <!-- Explicit right -->
                    <th class="text-right">Poids Net Total (kg)</th> <!-- Explicit right -->
                    <th class="text-right">Poids Brut Total (kg)</th> <!-- Explicit right -->
                    <th class="text-center">Dimensions Colis (cm)</th> <!-- Explicit center -->
                    <th class="text-right">Volume Colis (m³)</th> <!-- Explicit right -->
                </tr>
            </thead>
            <tbody>
                <!-- {{#each items}} -->
                <tr>
                    <td>{{item_number_or_code}}</td>
                    <td>{{item_description}}</td>
                    <td class="text-center">{{item_quantity_packages}}</td>
                    <td class="text-center">{{item_quantity_units_per_package}}</td>
                    <td class="text-center bold">{{item_total_units}}</td>
                    <td class="text-right">{{item_net_weight_per_unit_formatted}}</td>
                    <td class="text-right">{{item_gross_weight_per_unit_formatted}}</td>
                    <td class="text-right bold">{{item_total_net_weight_formatted}}</td>
                    <td class="text-right bold">{{item_total_gross_weight_formatted}}</td>
                    <td class="text-center">{{item_package_dimensions}}</td>
                    <td class="text-right">{{item_package_volume_formatted}}</td>
                </tr>
                <!-- {{/each}} -->
                 {{^items}}
                <tr>
                    <td colspan="11" class="text-center" style="padding: 20px;">Aucun article pour le moment.</td>
                </tr>
                {{/items}}
            </tbody>
        </table>

        <div class="section-title text-left">Totaux</div> <!-- Adjusted -->
        <table class="totals-table">
            <tr>
                <td style="width:70%;" class="text-left"><strong>Nombre total de colis:</strong></td> <!-- Adjusted -->
                <td class="text-right" style="width:30%;">{{total_packages_count}}</td>
            </tr>
            <tr>
                <td class="text-left"><strong>Poids Net Total de l'Expédition (kg):</strong></td> <!-- Adjusted -->
                <td class="text-right">{{total_net_weight_shipment_formatted}}</td>
            </tr>
            <tr>
                <td class="text-left"><strong>Poids Brut Total de l'Expédition (kg):</strong></td> <!-- Adjusted -->
                <td class="text-right">{{total_gross_weight_shipment_formatted}}</td>
            </tr>
            <tr>
                <td class="text-left"><strong>Volume Total de l'Expédition (m³):</strong></td> <!-- Adjusted -->
                <td class="text-right">{{total_volume_shipment_formatted}}</td>
            </tr>
        </table>

        <div class="declaration text-left"> <!-- Adjusted -->
            <div class="section-title">Déclaration</div>
            <p>{{declaration_statement}}</p>
        </div>

        <div class="instructions-section text-left"> <!-- Adjusted -->
            <div class="section-title">Instructions</div>
            <p>{{instructions}}</p>
        </div>

        <div class="signature-section-container">
            <table style="margin-top: 40px; border:none; width: 100%;">
                <tr>
                    <td style="width: 60%; border:none; vertical-align: bottom;" class="text-left"> <!-- Adjusted -->
                        <div class="signature-section">
                            <p>Pour et au nom de {{exporter_company_name}}:</p>
                            <div class="signature-line" style="margin-top: 50px;"></div>
                            <p><strong>{{authorized_signature_name}}</strong></p>
                            <p><em>{{authorized_signature_title}}</em></p>
                            <p>Date: {{signature_date}}</p>
                        </div>
                    </td>
                    <td style="width: 40%; text-align: center; border:none; vertical-align: top;">
                        {{#if company_logo_path_for_stamp}}
                        <div class="section-title" style="margin-top:0;">Cachet de l'Entreprise</div>
                        <div class="stamp-area">
                            <img src="{{company_logo_path_for_stamp}}" alt="Cachet de l'entreprise">
                        </div>
                        {{/if}}
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>